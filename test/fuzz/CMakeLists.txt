# Added for autogenerated headers and LuaJIT ones.
include_directories(${PROJECT_SOURCE_DIR}/src)
include_directories(${PROJECT_BINARY_DIR}/src)
include_directories(${PROJECT_SOURCE_DIR}/src/box)

# A special target with fuzzer and sanitizer flags.
add_library(fuzzer_config INTERFACE)

target_compile_options(
    fuzzer_config
    INTERFACE
        $<$<NOT:$<BOOL:${OSS_FUZZ}>>:
        -fsanitize=fuzzer
        >
        $<$<BOOL:${OSS_FUZZ}>:
        ${CXX}
        ${CXXFLAGS}
        >
)
target_link_libraries(
    fuzzer_config
    INTERFACE
        $<$<NOT:$<BOOL:${OSS_FUZZ}>>:
        -fsanitize=fuzzer
        >
        $<$<BOOL:${OSS_FUZZ}>:
        $ENV{LIB_FUZZING_ENGINE}
        >
)

# Use PUBLIC to force 'fuzzer_config' for all dependent targets.
add_executable(csv_fuzzer csv_fuzzer.c)
target_link_libraries(csv_fuzzer PUBLIC csv fuzzer_config)

add_executable(uri_fuzzer uri_fuzzer.c)
target_link_libraries(uri_fuzzer PUBLIC uri fuzzer_config)

add_executable(http_parser_fuzzer http_parser_fuzzer.c)
target_link_libraries(http_parser_fuzzer PUBLIC http_parser fuzzer_config)

set(fuzzing_binaries csv_fuzzer
                     http_parser_fuzzer
                     uri_fuzzer)

add_custom_target(fuzzers
                  DEPENDS ${fuzzing_binaries}
                  COMMENT "Build fuzzers")
