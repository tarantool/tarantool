session = box.session
---
...
utils = require('utils')
---
...
EMPTY_MAP = utils.setmap({})
---
...
--
-- Check a double create space
--
s = box.schema.space.create('test')
---
...
s = box.schema.space.create('test')
---
- error: Space 'test' already exists
...
--
-- Check a double drop space
--
s:drop()
---
...
s:drop()
---
- error: Space 'test' does not exist
...
--
-- Check double create user
--
box.schema.user.create('testus')
---
...
box.schema.user.create('testus')
---
- error: User 'testus' already exists
...
s = box.schema.space.create('admin_space')
---
...
index = s:create_index('primary', {type = 'hash', parts = {1, 'unsigned'}})
---
...
s:insert({1})
---
- [1]
...
s:insert({2})
---
- [2]
...
--
-- Check double grant and read access
--
box.schema.user.grant('testus', 'read', 'space', 'admin_space')
---
...
box.schema.user.grant('testus', 'read', 'space', 'admin_space')
---
- error: User 'testus' already has read access on space 'admin_space'
...
session.su('testus')
---
...
s:select(1)
---
- - [1]
...
s:insert({3})
---
- error: Write access to space 'admin_space' is denied for user 'testus'
...
s:delete(1)
---
- error: Write access to space 'admin_space' is denied for user 'testus'
...
s:drop()
---
- error: Write access to space '_space_sequence' is denied for user 'testus'
...
--
-- Check double revoke
--
session.su('admin')
---
...
box.schema.user.revoke('testus', 'read', 'space', 'admin_space')
---
...
box.schema.user.revoke('testus', 'read', 'space', 'admin_space')
---
- error: User 'testus' does not have read access on space 'admin_space'
...
session.su('testus')
---
...
s:select(1)
---
- error: Read access to space 'admin_space' is denied for user 'testus'
...
session.su('admin')
---
...
--
-- Check write access on space
--
box.schema.user.grant('testus', 'write', 'space', 'admin_space')
---
...
session.su('testus')
---
...
s:select(1)
---
- error: Read access to space 'admin_space' is denied for user 'testus'
...
s:delete(1)
---
- [1]
...
s:insert({3})
---
- [3]
...
s:drop()
---
- error: Write access to space '_space_sequence' is denied for user 'testus'
...
session.su('admin')
---
...
--
-- Check double drop user
--
box.schema.user.drop('testus')
---
...
box.schema.user.drop('testus')
---
- error: User 'testus' is not found
...
--
-- Check 'guest' user
--
session.su('guest')
---
...
session.uid()
---
- 0
...
box.space._user:select(1)
---
- error: Read access to space '_user' is denied for user 'guest'
...
s:select(1)
---
- error: Read access to space 'admin_space' is denied for user 'guest'
...
s:insert({4})
---
- error: Write access to space 'admin_space' is denied for user 'guest'
...
s:delete({3})
---
- error: Write access to space 'admin_space' is denied for user 'guest'
...
s:drop()
---
- error: Write access to space '_space_sequence' is denied for user 'guest'
...
gs = box.schema.space.create('guest_space')
---
- error: Write access to space '_schema' is denied for user 'guest'
...
--
-- FIXME: object create calls system space auto_increment, which requires
-- read and write privileges. Create privilege must solve this.
--
box.schema.func.create('guest_func')
---
- error: Read access to space '_func' is denied for user 'guest'
...
session.su('admin', box.schema.user.grant, "guest", "read", "universe")
---
...
box.schema.func.create('guest_func')
---
- error: Read access to space '_func' is denied for user 'guest'
...
session.su('admin')
---
...
box.schema.user.revoke("guest", "read", "universe")
---
...
s:select()
---
- - [2]
  - [3]
...
--
-- Create user with universe read&write grants
-- and create this user session
--
box.schema.user.create('uniuser')
---
...
box.schema.user.grant('uniuser', 'read, write, execute, create', 'universe')
---
...
session.su('uniuser')
---
...
uid = session.uid()
---
...
--
-- Check universal user
-- Check delete currently authenticated user
--
box.schema.user.drop('uniuser')
---
- error: 'Failed to drop user or role ''uniuser'': the user is active in the current
    session'
...
--
--Check create, call and drop function
--
box.schema.func.create('uniuser_func')
---
...
function uniuser_func() return 'hello' end
---
...
uniuser_func()
---
- hello
...
box.schema.func.drop('uniuser_func')
---
...
--
-- Check create and drop space
--
us = box.schema.space.create('uniuser_space')
---
...
us:drop()
---
...
--
-- Check create and drop user
--
box.schema.user.create('uniuser_testus')
---
...
box.schema.user.drop('uniuser_testus')
---
...
--
-- Check access system and any spaces
--
box.space.admin_space:select()
---
- - [2]
  - [3]
...
box.space._user:select(1)
---
- - [1, 1, 'admin', 'user', {}]
...
box.space._space:select(280)
---
- - [280, 1, '_space', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'owner',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'engine',
        'type': 'string'}, {'name': 'field_count', 'type': 'unsigned'}, {'name': 'flags',
        'type': 'map'}, {'name': 'format', 'type': 'array'}]]
...
us = box.schema.space.create('uniuser_space')
---
...
box.schema.func.create('uniuser_func')
---
...
session.su('admin')
---
...
box.schema.user.create('someuser')
---
...
box.schema.user.grant('someuser', 'read, write, execute, create', 'universe')
---
...
session.su('someuser')
---
...
--
-- Check drop objects of another user
--
s:drop()
---
- error: Drop access to space 'admin_space' is denied for user 'someuser'
...
us:drop()
---
- error: Drop access to space 'uniuser_space' is denied for user 'someuser'
...
box.schema.func.drop('uniuser_func')
---
- error: Drop access to function 'uniuser_func' is denied for user 'someuser'
...
box.schema.user.drop('uniuser_testus')
---
- error: User 'uniuser_testus' is not found
...
session.su('admin')
---
...
box.schema.func.drop('uniuser_func')
---
...
box.schema.user.drop('someuser')
---
...
box.schema.user.drop('uniuser_testus')
---
- error: User 'uniuser_testus' is not found
...
box.schema.user.drop('uniuser')
---
...
_ = box.space._user:delete(uid)
---
...
s:drop()
---
...
--
-- Check write grant on _user
--
box.schema.user.create('testuser')
---
...
maxuid = box.space._user.index.primary:max()[1]
---
...
box.schema.user.grant('testuser', 'write', 'space', '_user')
---
...
box.schema.user.grant('testuser', 'create', 'universe')
---
...
session.su('testuser')
---
...
testuser_uid = session.uid()
---
...
_ = box.space._user:delete(2)
---
- error: Drop access to role 'public' is denied for user 'testuser'
...
box.space._user:select(1)
---
- error: Read access to space '_user' is denied for user 'testuser'
...
uid = box.space._user:insert{maxuid+1, session.uid(), 'someone', 'user', EMPTY_MAP}[1]
---
...
_ = box.space._user:delete(uid)
---
...
session.su('admin')
---
...
box.space._user:select(1)
---
- - [1, 1, 'admin', 'user', {}]
...
_ = box.space._user:delete(testuser_uid)
---
- error: 'Failed to drop user or role ''testuser'': the user has objects'
...
box.schema.user.revoke('testuser', 'write', 'space', '_user')
---
...
--
-- Check read grant on _user
--
box.schema.user.grant('testuser', 'read', 'space', '_user')
---
...
session.su('testuser')
---
...
_  = box.space._user:delete(2)
---
- error: Write access to space '_user' is denied for user 'testuser'
...
box.space._user:select(1)
---
- - [1, 1, 'admin', 'user', {}]
...
box.space._user:insert{uid, session.uid(), 'someone2', 'user'}
---
- error: Write access to space '_user' is denied for user 'testuser'
...
session.su('admin')
---
...
--
-- Check read grant on _index
--
box.schema.user.grant('testuser', 'read', 'space', '_index')
---
...
session.su('testuser')
---
...
box.space._index:select(272)
---
- - [272, 0, 'primary', 'tree', {'unique': true}, [[0, 'string']]]
...
box.space._index:insert{512, 1,'owner','tree', 1, 1, 0,'unsigned'}
---
- error: Write access to space '_index' is denied for user 'testuser'
...
session.su('admin')
---
...
box.schema.user.revoke('testuser', 'usage,session', 'universe')
---
...
box.schema.user.revoke('testuser', 'read, write, execute', 'universe')
---
- error: User 'testuser' does not have read, write, execute access on universe ''
...
box.schema.user.revoke('testuser', 'create', 'universe')
---
...
box.schema.user.grant('testuser', 'usage,session', 'universe')
---
...
--
-- Check that itertors check privileges
--
s = box.schema.space.create('glade')
---
...
box.schema.user.grant('testuser', 'read', 'space', 'glade')
---
...
index = s:create_index('primary', {unique = true, parts = {1, 'unsigned', 2, 'string'}})
---
...
s:insert({1, 'A'})
---
- [1, 'A']
...
s:insert({2, 'B'})
---
- [2, 'B']
...
s:insert({3, 'C'})
---
- [3, 'C']
...
s:insert({4, 'D'})
---
- [4, 'D']
...
t = {}
---
...
for key, v in s.index.primary:pairs(3, {iterator = 'GE'}) do table.insert (t, v) end
---
...
t
---
- - [3, 'C']
  - [4, 'D']
...
t = {}
---
...
session.su('testuser')
---
...
s:select()
---
- - [1, 'A']
  - [2, 'B']
  - [3, 'C']
  - [4, 'D']
...
for key, v in s.index.primary:pairs(3, {iterator = 'GE'}) do table.insert (t, v) end
---
...
t
---
- - [3, 'C']
  - [4, 'D']
...
t = {}
---
...
session.su('admin')
---
...
box.schema.user.revoke('testuser', 'read', 'space', 'glade')
---
...
box.schema.user.grant('testuser', 'write', 'space', 'glade')
---
...
session.su('testuser')
---
...
s:select()
---
- error: Read access to space 'glade' is denied for user 'testuser'
...
for key, v in s.index.primary:pairs(1, {iterator = 'GE'}) do table.insert (t, v) end
---
- error: Read access to space 'glade' is denied for user 'testuser'
...
t
---
- []
...
t = {}
---
...
session.su('admin')
---
...
box.schema.user.grant('testuser', 'read, write, execute', 'space', 'glade')
---
...
session.su('testuser')
---
...
s:select()
---
- - [1, 'A']
  - [2, 'B']
  - [3, 'C']
  - [4, 'D']
...
for key, v in s.index.primary:pairs(3, {iterator = 'GE'}) do table.insert (t, v) end
---
...
t
---
- - [3, 'C']
  - [4, 'D']
...
t = {}
---
...
session.su('guest')
---
...
s:select()
---
- error: Read access to space 'glade' is denied for user 'guest'
...
for key, v in s.index.primary:pairs(3, {iterator = 'GE'}) do table.insert (t, v) end
---
- error: Read access to space 'glade' is denied for user 'guest'
...
t
---
- []
...
t = {}
---
...
session.su('guest')
---
...
s:select()
---
- error: Read access to space 'glade' is denied for user 'guest'
...
for key, v in s.index.primary:pairs(3, {iterator = 'GE'}) do table.insert (t, v) end
---
- error: Read access to space 'glade' is denied for user 'guest'
...
t
---
- []
...
--
-- Check that alter and truncate do not affect space access control.
--
session.su('admin')
---
...
_ = s:create_index('secondary', {unique = false, parts = {2, 'string'}})
---
...
session.su('testuser')
---
...
s:select()
---
- - [1, 'A']
  - [2, 'B']
  - [3, 'C']
  - [4, 'D']
...
session.su('admin')
---
...
s:truncate()
---
...
s:insert({1234, 'ABCD'})
---
- [1234, 'ABCD']
...
session.su('testuser')
---
...
s:select()
---
- - [1234, 'ABCD']
...
session.su('admin')
---
...
box.schema.user.drop('testuser')
---
...
s:drop()
---
...
--
-- gh-3089 usage access is not applied to owner
--
box.schema.user.grant("guest","read, write, execute, create", "universe")
---
...
box.session.su("guest")
---
...
s = box.schema.space.create("test")
---
...
_ = s:create_index("prim")
---
...
test_func = function() end
---
...
box.schema.func.create('test_func')
---
...
sq = box.schema.sequence.create("test")
---
...
box.session.su("admin")
---
...
box.schema.user.revoke("guest", "usage", "universe")
---
...
box.session.su("guest")
---
...
s:select{}
---
- error: Usage access to universe '' is denied for user 'guest'
...
s:drop()
---
- error: Usage access to universe '' is denied for user 'guest'
...
sq:set(100)
---
- error: Usage access to universe '' is denied for user 'guest'
...
sq:drop()
---
- error: Usage access to universe '' is denied for user 'guest'
...
c = require("net.box").connect(os.getenv("LISTEN"))
---
...
c:call("test_func")
---
- error: Usage access to universe '' is denied for user 'guest'
...
box.session.su("admin")
---
...
box.schema.user.revoke("guest","read, write, execute, create", "universe")
---
...
box.session.su("guest")
---
...
s:select{}
---
- error: Usage access to universe '' is denied for user 'guest'
...
s:drop()
---
- error: Usage access to universe '' is denied for user 'guest'
...
sq:set(100)
---
- error: Usage access to universe '' is denied for user 'guest'
...
sq:drop()
---
- error: Usage access to universe '' is denied for user 'guest'
...
c = require("net.box").connect(os.getenv("LISTEN"))
---
...
c:call("test_func")
---
- error: Usage access to universe '' is denied for user 'guest'
...
box.session.su("admin")
---
...
box.schema.user.grant("guest","usage", "universe")
---
...
box.schema.func.drop("test_func")
---
...
s:drop()
---
...
sq:drop()
---
...
box.space._user:select()
---
- - [0, 1, 'guest', 'user', {'chap-sha1': 'vhvewKp0tNyweZQ+cFKAlsyphfg='}]
  - [1, 1, 'admin', 'user', {}]
  - [2, 1, 'public', 'role', {}]
  - [3, 1, 'replication', 'role', {}]
  - [31, 1, 'super', 'role', {}]
...
box.space._space:select()
---
- - [257, 1, '_vinyl_deferred_delete', 'blackhole', 0, {'group_id': 1}, [{'name': 'space_id',
        'type': 'unsigned'}, {'name': 'lsn', 'type': 'unsigned'}, {'name': 'tuple',
        'type': 'array'}]]
  - [272, 1, '_schema', 'memtx', 0, {}, [{'type': 'string', 'name': 'key'}, {'type': 'any',
        'name': 'value', 'is_nullable': true}]]
  - [276, 1, '_collation', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {
        'name': 'name', 'type': 'string'}, {'name': 'owner', 'type': 'unsigned'},
      {'name': 'type', 'type': 'string'}, {'name': 'locale', 'type': 'string'}, {
        'name': 'opts', 'type': 'map'}]]
  - [277, 1, '_vcollation', 'sysview', 0, {}, [{'name': 'id', 'type': 'unsigned'},
      {'name': 'name', 'type': 'string'}, {'name': 'owner', 'type': 'unsigned'}, {
        'name': 'type', 'type': 'string'}, {'name': 'locale', 'type': 'string'}, {
        'name': 'opts', 'type': 'map'}]]
  - [280, 1, '_space', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'owner',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'engine',
        'type': 'string'}, {'name': 'field_count', 'type': 'unsigned'}, {'name': 'flags',
        'type': 'map'}, {'name': 'format', 'type': 'array'}]]
  - [281, 1, '_vspace', 'sysview', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'owner',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'engine',
        'type': 'string'}, {'name': 'field_count', 'type': 'unsigned'}, {'name': 'flags',
        'type': 'map'}, {'name': 'format', 'type': 'array'}]]
  - [284, 1, '_sequence', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'owner',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'step',
        'type': 'integer'}, {'name': 'min', 'type': 'integer'}, {'name': 'max', 'type': 'integer'},
      {'name': 'start', 'type': 'integer'}, {'name': 'cache', 'type': 'integer'},
      {'name': 'cycle', 'type': 'boolean'}]]
  - [285, 1, '_sequence_data', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'},
      {'name': 'value', 'type': 'integer'}]]
  - [286, 1, '_vsequence', 'sysview', 0, {}, [{'name': 'id', 'type': 'unsigned'},
      {'name': 'owner', 'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {
        'name': 'step', 'type': 'integer'}, {'name': 'min', 'type': 'integer'}, {
        'name': 'max', 'type': 'integer'}, {'name': 'start', 'type': 'integer'}, {
        'name': 'cache', 'type': 'integer'}, {'name': 'cycle', 'type': 'boolean'}]]
  - [288, 1, '_index', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'iid',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'type',
        'type': 'string'}, {'name': 'opts', 'type': 'map'}, {'name': 'parts', 'type': 'array'}]]
  - [289, 1, '_vindex', 'sysview', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'iid',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'type',
        'type': 'string'}, {'name': 'opts', 'type': 'map'}, {'name': 'parts', 'type': 'array'}]]
  - [296, 1, '_func', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'owner',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'setuid',
        'type': 'unsigned'}, {'name': 'language', 'type': 'string'}, {'name': 'body',
        'type': 'string'}, {'name': 'routine_type', 'type': 'string'}, {'name': 'param_list',
        'type': 'array'}, {'name': 'returns', 'type': 'string'}, {'name': 'aggregate',
        'type': 'string'}, {'name': 'sql_data_access', 'type': 'string'}, {'name': 'is_deterministic',
        'type': 'boolean'}, {'name': 'is_sandboxed', 'type': 'boolean'}, {'name': 'is_null_call',
        'type': 'boolean'}, {'name': 'exports', 'type': 'array'}, {'name': 'opts',
        'type': 'map'}, {'name': 'comment', 'type': 'string'}, {'name': 'created',
        'type': 'string'}, {'name': 'last_altered', 'type': 'string'}]]
  - [297, 1, '_vfunc', 'sysview', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'owner',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'setuid',
        'type': 'unsigned'}]]
  - [304, 1, '_user', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'owner',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'type',
        'type': 'string'}, {'name': 'auth', 'type': 'map'}]]
  - [305, 1, '_vuser', 'sysview', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'owner',
        'type': 'unsigned'}, {'name': 'name', 'type': 'string'}, {'name': 'type',
        'type': 'string'}, {'name': 'auth', 'type': 'map'}]]
  - [312, 1, '_priv', 'memtx', 0, {}, [{'name': 'grantor', 'type': 'unsigned'}, {
        'name': 'grantee', 'type': 'unsigned'}, {'name': 'object_type', 'type': 'string'},
      {'name': 'object_id', 'type': 'scalar'}, {'name': 'privilege', 'type': 'unsigned'}]]
  - [313, 1, '_vpriv', 'sysview', 0, {}, [{'name': 'grantor', 'type': 'unsigned'},
      {'name': 'grantee', 'type': 'unsigned'}, {'name': 'object_type', 'type': 'string'},
      {'name': 'object_id', 'type': 'scalar'}, {'name': 'privilege', 'type': 'unsigned'}]]
  - [320, 1, '_cluster', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'uuid',
        'type': 'string'}]]
  - [328, 1, '_trigger', 'memtx', 0, {}, [{'name': 'name', 'type': 'string'}, {'name': 'space_id',
        'type': 'unsigned'}, {'name': 'opts', 'type': 'map'}]]
  - [330, 1, '_truncate', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'}, {'name': 'count',
        'type': 'unsigned'}]]
  - [340, 1, '_space_sequence', 'memtx', 0, {}, [{'name': 'id', 'type': 'unsigned'},
      {'name': 'sequence_id', 'type': 'unsigned'}, {'name': 'is_generated', 'type': 'boolean'},
      {'name': 'field', 'type': 'unsigned'}, {'name': 'path', 'type': 'string'}]]
  - [356, 1, '_fk_constraint', 'memtx', 0, {}, [{'name': 'name', 'type': 'string'},
      {'name': 'child_id', 'type': 'unsigned'}, {'name': 'parent_id', 'type': 'unsigned'},
      {'name': 'is_deferred', 'type': 'boolean'}, {'name': 'match', 'type': 'string'},
      {'name': 'on_delete', 'type': 'string'}, {'name': 'on_update', 'type': 'string'},
      {'name': 'child_cols', 'type': 'array'}, {'name': 'parent_cols', 'type': 'array'}]]
  - [364, 1, '_ck_constraint', 'memtx', 0, {}, [{'name': 'space_id', 'type': 'unsigned'},
      {'name': 'name', 'type': 'string'}, {'name': 'is_deferred', 'type': 'boolean'},
      {'name': 'language', 'type': 'str'}, {'name': 'code', 'type': 'str'}]]
...
box.space._func:select()
---
- - [1, 1, 'box.schema.user.info', 1, 'LUA', '', 'function', [], 'any', 'none', 'none',
    false, false, true, ['LUA'], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [2, 1, 'TRIM', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [3, 1, 'TYPEOF', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [4, 1, 'PRINTF', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [5, 1, 'UNICODE', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [6, 1, 'CHAR', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [7, 1, 'HEX', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [8, 1, 'VERSION', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [9, 1, 'QUOTE', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [10, 1, 'REPLACE', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [11, 1, 'SUBSTR', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [12, 1, 'GROUP_CONCAT', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [13, 1, 'JULIANDAY', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [14, 1, 'DATE', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [15, 1, 'TIME', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [16, 1, 'DATETIME', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [17, 1, 'STRFTIME', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [18, 1, 'CURRENT_TIME', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [19, 1, 'CURRENT_TIMESTAMP', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none',
    'none', false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [20, 1, 'CURRENT_DATE', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [21, 1, 'LENGTH', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [22, 1, 'POSITION', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [23, 1, 'ROUND', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [24, 1, 'UPPER', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [25, 1, 'LOWER', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [26, 1, 'IFNULL', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [27, 1, 'RANDOM', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [28, 1, 'CEIL', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [29, 1, 'CEILING', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [30, 1, 'CHARACTER_LENGTH', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none',
    'none', false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [31, 1, 'CHAR_LENGTH', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [32, 1, 'FLOOR', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [33, 1, 'MOD', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [34, 1, 'OCTET_LENGTH', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [35, 1, 'ROW_COUNT', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [36, 1, 'COUNT', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [37, 1, 'LIKE', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [38, 1, 'ABS', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [39, 1, 'EXP', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [40, 1, 'LN', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [41, 1, 'POWER', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [42, 1, 'SQRT', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [43, 1, 'SUM', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [44, 1, 'TOTAL', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [45, 1, 'AVG', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [46, 1, 'RANDOMBLOB', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [47, 1, 'NULLIF', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [48, 1, 'ZEROBLOB', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [49, 1, 'MIN', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [50, 1, 'MAX', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [51, 1, 'COALESCE', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [52, 1, 'EVERY', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [53, 1, 'EXISTS', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [54, 1, 'EXTRACT', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [55, 1, 'SOME', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none', false,
    false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [56, 1, 'GREATER', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [57, 1, 'LESSER', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [58, 1, 'SOUNDEX', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [59, 1, 'LIKELIHOOD', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [60, 1, 'LIKELY', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [61, 1, 'UNLIKELY', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none', 'none',
    false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [62, 1, '_sql_stat_get', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none',
    'none', false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [63, 1, '_sql_stat_push', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none',
    'none', false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [64, 1, '_sql_stat_init', 1, 'SQL_BUILTIN', '', 'function', [], 'any', 'none',
    'none', false, false, true, [], {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
  - [65, 1, 'LUA', 1, 'LUA', 'function(code) return assert(loadstring(code))() end',
    'function', ['string'], 'any', 'none', 'none', false, false, true, ['LUA', 'SQL'],
    {}, '', '2019-07-11 13:57:48', '2019-07-11 13:57:48']
...
session = nil
---
...
-- an error when granting or revoking non-existent privilege
box.schema.user.grant("guest", "everything", "universe")
---
- error: Unsupported universe privilege 'everything'
...
box.schema.user.revoke("guest", "everything", "universe")
---
- error: Unsupported universe privilege 'everything'
...
-- an error when granting or revoking a privilege on a non-existent entity
box.schema.user.grant("guest", "read", "everywhere")
---
- error: Unknown object type 'everywhere'
...
box.schema.user.revoke("guest", "read", "everywhere")
---
- error: Unknown object type 'everywhere'
...
-- an error even when granting or revoking a non-existent privilege
-- on a non-existent entity
box.schema.user.grant("guest", "everything", "everywhere")
---
- error: Unknown object type 'everywhere'
...
box.schema.user.revoke("guest", "everything", "everywhere")
---
- error: Unknown object type 'everywhere'
...
--  produce an error if revoking a non-granted privilege
box.schema.user.create("tester")
---
...
box.schema.user.grant('tester', 'read', 'universe')
---
...
-- error: the privilege is not granted
box.schema.user.revoke('tester', 'create', 'universe')
---
- error: User 'tester' does not have create access on universe ''
...
-- no error: if_exists clause
box.schema.user.revoke('tester', 'create', 'universe', nil, { if_exists = true })
---
...
-- no error: the privilege is granted
box.schema.user.revoke('tester', 'read', 'universe')
---
...
box.schema.user.grant('tester', 'read', 'universe')
---
...
-- no error: some privileges are revoked
box.schema.user.revoke('tester', 'read,create', 'universe')
---
...
box.schema.user.drop('tester')
---
...
