box.schema.user.grant('guest', 'read,write,execute', 'universe')
---
...

#
# iproto packages test
#


# Test bug #899343 (server assertion failure on incorrect packet)

# send the package with invalid length
12
# check that is server alive
True

#  Test gh-206 "Segfault if sending IPROTO package without `KEY` field"

IPROTO_SELECT
query {'IPROTO_CODE': 1} {'IPROTO_SPACE_ID': 280}
True


IPROTO_DELETE
query {'IPROTO_CODE': 5} {'IPROTO_SPACE_ID': 280}
True


IPROTO_UPDATE
query {'IPROTO_CODE': 4} {'IPROTO_SPACE_ID': 280}
True
query {'IPROTO_CODE': 4} {'IPROTO_SPACE_ID': 280, 'IPROTO_KEY': (1,)}
True


IPROTO_REPLACE
query {'IPROTO_CODE': 3} {'IPROTO_SPACE_ID': 280}
True


IPROTO_CALL
query {'IPROTO_CODE': 6} {}
True
query {'IPROTO_CODE': 6} {'IPROTO_KEY': ('procname',)}
True


box.cfg.wal_mode
---
- write
...
space = box.schema.space.create('test', { id = 567 })
---
...
index = space:create_index('primary', { type = 'hash' })
---
...
box.schema.user.grant('guest', 'read,write,execute', 'space', 'test')
---
...
- [1, baobab]

- [2, obbaba]

- [1, baobab]

- [3, occama]

- [2, obbaba]

- [4, ockham]

- [1, baobab]

- [2, obbaba]

space:drop()
---
...
space = box.schema.space.create('test')
---
...
index = space:create_index('primary', { type = 'hash', parts = {1, 'str'}})
---
...
STR 1
--
0xa1 => ok ok ok ok ok ok
0xd901 => ok ok ok ok ok ok
0xda0001 => ok ok ok ok ok ok
0xdb00000001 => ok ok ok ok ok ok

STR 31
--
0xbf => ok ok ok ok ok ok
0xd91f => ok ok ok ok ok ok
0xda001f => ok ok ok ok ok ok
0xdb0000001f => ok ok ok ok ok ok

STR 32
--
0xd920 => ok ok ok ok ok
0xda0020 => ok ok ok ok ok
0xdb00000020 => ok ok ok ok ok

STR 255
--
0xd9ff => ok ok ok ok ok
0xda00ff => ok ok ok ok ok
0xdb000000ff => ok ok ok ok ok

STR 256
--
0xda0100 => ok ok ok ok
0xdb00000100 => ok ok ok ok

STR 65535
--
0xdaffff => ok ok ok ok
0xdb0000ffff => ok ok ok ok

STR 65536
--
0xdb00010000 => ok ok ok

space:drop()
---
...
box.schema.user.revoke('guest', 'read,write,execute', 'universe')
---
...
